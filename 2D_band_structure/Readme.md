

## Relaxation

need POSCAR, POTCAR, INCAR (KPOINTS DOESNT INFLUENCE RELAXATION??):

```
                                   File: POSCAR                                                                                     
Graphite Lattice
1.0
 2.4410462393  0.0000000000  0.0000000000 
-1.2205231197  2.1140080551  0.0000000000 
 0.0000000000  0.0000000000 10.0000000000 
C
2
Cartesian
 0.0000000000  0.0000000000  0.0000000000 
 0.0000000000  1.4093387034  0.0000000000 
```

I. Standardize POSCAR, ensuring that the z-coordinate center of the material aligns with |c|/2.
Since the K-path generated by VASPKIT relies on a standardized primitive cell, it's essential to correctly standardize the crystal cell for 2D materials using VASPKIT. Here's a series of steps to ensure this standardization process:

   1. Use VASPKIT version `921` or `923`.
   2. Apply standardization specifically for 2D materials.
   3. Ensure that the z-coordinate center of the 2D material is at |c|/2 (i.e., fractional coordinate z = 0.5).
   4. Utilize VASPKIT 923 for the standardization process, which involves:
      - Placing a vacuum layer in the z-direction.
      - Centering the 2D material along the z-coordinate.

```
                                   File: POSCAR_REV                                                                                      
Graphite Lattice
   1.000
    2.4410462392999999    0.0000000000000000    0.0000000000000000
   -1.2205231196999993    2.1140080551000002    0.0000000000000000
    0.0000000000000006    0.0000000000000011   10.0000000000000000
C
2
Cartesian
    0.0000000000000000    0.0000000000000001    5.0000000000000000     C1
    0.0000000000000005    1.4093387034000002    5.0000000000000000     C2

```
   5. rename by using : `cp POSCAR_REV POSCAR'

II. Create INCAR file to perform Standard Relaxation (geometry optimization) using vaspkit `101` and `SR`, the default is : 
```                                                                             

                                      File: INCAR                                                                                      

Global Parameters
ISTART =  1            (Read existing wavefunction, if there)
ISPIN  =  1            (Non-Spin polarised DFT)
# ICHARG =  11         (Non-self-consistent: GGA/LDA band structures)
LREAL  = .FALSE.       (Projection operators: automatic)
# ENCUT  =  400        (Cut-off energy for plane wave basis set, in eV)
# PREC   =  Accurate   (Precision level: Normal or Accurate, set Accurate when perform structure lattice relaxation calculation)
LWAVE  = .TRUE.        (Write WAVECAR or not)
LCHARG = .TRUE.        (Write CHGCAR or not)
ADDGRID= .TRUE.        (Increase grid, helps GGA convergence)
# LVTOT  = .TRUE.      (Write total electrostatic potential into LOCPOT or not)
# LVHAR  = .TRUE.      (Write ionic + Hartree electrostatic potential into LOCPOT or not)
# NELECT =             (No. of electrons: charged cells, be careful)
# LPLANE = .TRUE.      (Real space distribution, supercells)
# NWRITE = 2           (Medium-level output)
# KPAR   = 2           (Divides k-grid into separate groups)
# NGXF    = 300        (FFT grid mesh density for nice charge/potential plots)
# NGYF    = 300        (FFT grid mesh density for nice charge/potential plots)
# NGZF    = 300        (FFT grid mesh density for nice charge/potential plots)

Electronic Relaxation
ISMEAR =  0            (Gaussian smearing, metals:1)
SIGMA  =  0.05         (Smearing value in eV, metals:0.2)
NELM   =  90           (Max electronic SCF steps)
NELMIN =  6            (Min electronic SCF steps)
EDIFF  =  1E-08        (SCF energy convergence, in eV)
# GGA  =  PS           (PBEsol exchange-correlation)

Ionic Relaxation
NSW    =  100          (Max ionic steps)
IBRION =  2            (Algorithm: 0-MD, 1-Quasi-New, 2-CG)
ISIF   =  2            (Stress/relaxation: 2-Ions, 3-Shape/Ions/V, 4-Shape/Ions)
EDIFFG = -2E-02        (Ionic convergence, eV/AA)
# ISYM =  2            (Symmetry: 0=none, 2=GGA, 3=hybrids)
```

III. Generate POTCAR using vaspkit `103`

IV. Run calculation

## SCF

I. After the SR calculation is complete, make a new directory called scf using 'mkdir scf' and then change your active directory to that folder 'cd scf' and then copy in the CONTCAR as POSCAR 'cp ../CONTCAR POSCAR' and the POTCAR 'cp ../POTCAR .'

II. Create INCAR file to perform Static-Calculations (SCF) using vaspkit `101` and `ST`, the default is : 

```
                                    File: INCAR    
Global Parameters
ISTART =  1            (Read existing wavefunction, if there)
ISPIN  =  1            (Non-Spin polarised DFT)
# ICHARG =  11         (Non-self-consistent: GGA/LDA band structures)
LREAL  = .FALSE.       (Projection operators: automatic)
# ENCUT  =  400        (Cut-off energy for plane wave basis set, in eV)
# PREC   =  Accurate   (Precision level: Normal or Accurate, set Accurate when perform structure lattice relaxation calculation)
LWAVE  = .TRUE.        (Write WAVECAR or not)
LCHARG = .TRUE.        (Write CHGCAR or not)
ADDGRID= .TRUE.        (Increase grid, helps GGA convergence)
# LVTOT  = .TRUE.      (Write total electrostatic potential into LOCPOT or not)
# LVHAR  = .TRUE.      (Write ionic + Hartree electrostatic potential into LOCPOT or not)
# NELECT =             (No. of electrons: charged cells, be careful)
# LPLANE = .TRUE.      (Real space distribution, supercells)
# NWRITE = 2           (Medium-level output)
# KPAR   = 2           (Divides k-grid into separate groups)
# NGXF    = 300        (FFT grid mesh density for nice charge/potential plots)
# NGYF    = 300        (FFT grid mesh density for nice charge/potential plots)
# NGZF    = 300        (FFT grid mesh density for nice charge/potential plots)

Static Calculation
ISMEAR =  0            (gaussian smearing method)
SIGMA  =  0.05         (please check the width of the smearing)
LORBIT =  11           (PAW radii for projected DOS)
NEDOS  =  2001         (DOSCAR points)
NELM   =  60           (Max electronic SCF steps)
EDIFF  =  1E-08        (SCF energy convergence, in eV)
```
III. Run calculation

### Band Structure / DOS

I. After the SCF calculation is completed, make a directory called dos using 'mkdir dos' and then change your active directory to that folder 'cd dos' and then copy in the CONTCAR as POSCAR 'cp ../CONTCAR POSCAR' and the POTCAR 'cp ../POTCAR .'

II. Copy in the 'CHGCAR' from the SCF folder 'cp ../CHGCAR .'

III. Create K-Path for 2D Structure using vaspkit '302'. This creates several files, but we want 'KPATH.in' and copy it to 'KPOINT' using 'cp KPATH.in KPOINT'

IV. Delete the INCAR created from the previous step using 'rm INCAR' and then create a new INCAR file to perform DOS calculations using 'nano INCAR' :

```
                                    File: INCAR                                                                                      
##### initial I/O #####
SYSTEM = MoS2
ICHARG = 11
LWAVE = .TRUE.
LCHARG = .TRUE.
LVTOT = .FALSE.
LVHAR = .FALSE.
LELF = .FALSE.
LORBIT = 11
NEDOS = 1000

##### SCF #####
#ENCUT = 500
ISMEAR = 0
SIGMA = 0.05
EDIFF = 1E-6
NELMIN = 5
NELM = 300
GGA = PE
LREAL = .FALSE.
#PREC = Accurate
```
V. Run calculation

### Ploting DOS

I. Run vaspkit 


```
import matplotlib.pyplot as plt

path_M = '/nas/longleaf/home/........../scf/dos/'


# Read data from the file
file_path = str(path_M)+'BAND.dat'
data = {'bands': []}
num_bands = 0  # Initialize num_bands to 0

with open(file_path, 'r') as file:
    current_band = None
    for line in file:
        if line.startswith('# NBANDS:'):
            num_bands = int(line.split()[2])
        elif line.startswith('# Band-Index'):
            current_band = {'k_path': [], 'energy_levels': []}
            data['bands'].append(current_band)
        elif line.startswith('#') or not line.strip():
            continue
        else:
            values = line.split()
            if len(values) >= 2:
                k_path, energy_level = map(float, values[:2])
                current_band['k_path'].append(k_path)
                current_band['energy_levels'].append(energy_level)

                
selected_data = {'bands': []}

# Iterate over each band's data
for band_data in data['bands']:
    # Check if any energy level falls within the specified range
    energy_levels = [energy_level for energy_level in band_data['energy_levels'] if -15 <= energy_level <= 6]
    
    # If at least one energy level falls within the range, add the band to selected_data
    if energy_levels:
        selected_band = {'k_path': band_data['k_path'], 'energy_levels': energy_levels}
        selected_data['bands'].append(selected_band)                

# Plotting
for band_index, band_data in enumerate(data['bands']):
    label = f'Band {band_index + 1}'
    plt.plot(band_data['k_path'], band_data['energy_levels'], color='blue', label=label)

plt.xlabel('K-Path (1/A)')
plt.ylabel('Energy-Level (eV)')
#plt.legend()
plt.title('Band Structure')
plt.ylim(-15, 10)
plt.show()

import matplotlib.pyplot as plt

# Plotting
for band_index, band_data in enumerate(selected_data['bands']):
    # Check if the lengths of 'k_path' and 'energy_levels' are equal
    if len(band_data['k_path']) != len(band_data['energy_levels']):
        print(f"Skipping band {band_index + 1} due to mismatched array lengths.")
        continue
    
    label = f'Band {band_index + 1}'
    plt.plot(band_data['k_path'], band_data['energy_levels'], color='blue', label=label)

plt.xlabel('K-Path (1/A)')
plt.ylabel('Energy-Level (eV)')
plt.title('Band Structure')
plt.ylim(-15, 10)
plt.show()

```
